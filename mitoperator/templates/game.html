<html>
  <head>
    <script src="/static/js/processing.js"></script>
    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/socket.io.js"></script>
    <script type="text/javascript">
      var canvas;
      var ctx;
      var drawing=false;

      var pmouseX=null;
      var pmouseY=null;

      var currpath=null;

      function Path(ctx){
        this.ctx = ctx;
        this.pts = [];
      }

      $(document).ready( function() {

        function handle(delta) {
          console.log( delta );
        }

        function wheel(event){
          var delta = 0;
          if (!event) /* For IE. */
            event = window.event;
          if (event.wheelDelta) { /* IE/Opera. */
            delta = event.wheelDelta/120;
          } else if (event.detail) { /** Mozilla case. */
          /** In Mozilla, sign of delta is different than in IE.
            * Also, delta is multiple of 3.
            */
            delta = -event.detail/3;
          }
          /** If delta is nonzero, handle it.
            * Basically, delta is now positive if wheel was scrolled up,
            * and negative, if wheel was scrolled down.
            */
          if (delta)
            handle(delta);
          /** Prevent default actions caused by mouse wheel.
            * That might be ugly, but we handle scrolls somehow
            * anyway, so don't bother here..
            */
          if (event.preventDefault)
            event.preventDefault();
          event.returnValue = false;
        }

        canvas = $("#canvas")[0]
        ctx = canvas.getContext("2d");

        canvas.onmousedown = function(ev) {
          if(ev.button==0) {
            drawing=true;
          }
        }
        canvas.onmouseup = function(ev) {
          if(drawing){
            drawing=false;
          }
        }

        canvas.onmousemove = function(ev){
          if(drawing && pmouseX) {
            ctx.beginPath();
            ctx.moveTo(pmouseX,pmouseY);
            ctx.lineTo(ev.offsetX, ev.offsetY);
            ctx.stroke();
          }
          pmouseX=ev.offsetX;
          pmouseY=ev.offsetY;
        } 

        if (window.addEventListener)
          /** DOMMouseScroll is for mozilla. */
          window.addEventListener('DOMMouseScroll', wheel, false);
        /** IE/Opera. */
        window.onmousewheel = document.onmousewheel = wheel;
      });
    </script>
  </head>
  <body>
    <canvas id="canvas" width="1000" height="1000"></canvas>
    <img id="dump">
  </body>
</html>
